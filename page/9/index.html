<!DOCTYPE html>
<html lang="zh-cn">
<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="leek" />


    
     
        <meta name="google-site-verification" content="Vl02j4hnvtN2AJ3EfPjyvrHb191mbrnVtUlHgPUKBp0" />
    


<meta property="og:type" content="website">
<meta property="og:title" content="leek 自留地">
<meta property="og:url" content="https://imlike.cc/page/9/index.html">
<meta property="og:site_name" content="leek 自留地">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="leek">
<meta name="twitter:card" content="summary">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="leek 自留地" type="application/atom+xml">



    <link rel="shortcut icon" href="pics/g.jpg">



    <link href="//lf6-cdn-tos.bytecdntp.com/cdn/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//lf6-cdn-tos.bytecdntp.com/cdn/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//lf6-cdn-tos.bytecdntp.com/cdn/pace/1.0.2/pace.min.js"></script>
    <link href="//lf6-cdn-tos.bytecdntp.com/cdn/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">



<link rel="stylesheet" href="/css/style.css">



    <!-- 注释 -->
    <!-- <style> .article { opacity: 0;} </style> -->


<link href="//lf6-cdn-tos.bytecdntp.com/cdn/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>leek 自留地</title>

<script src="//lf6-cdn-tos.bytecdntp.com/cdn/jquery/2.2.4/jquery.min.js"></script>
<script src="//lf6-cdn-tos.bytecdntp.com/cdn/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//lf6-cdn-tos.bytecdntp.com/cdn/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//lf6-cdn-tos.bytecdntp.com/cdn/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






<meta name="generator" content="Hexo 5.2.0"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="https://pic.superbed.cn/item/5c9f2d213a213b04176522d4" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/"></a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="true" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:s@yandex.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" rel="noopener" href="https://github.com/bigleek" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa Google" target="_blank" rel="noopener" href="https://plus.google.com/bigleekcode" title="Google"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Yelee/" rel="tag">Yelee</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Yilia/" rel="tag">Yilia</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/activiti/" rel="tag">activiti</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/alist/" rel="tag">alist</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/axios/" rel="tag">axios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/binary/" rel="tag">binary</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ceph/" rel="tag">ceph</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clickhouse/" rel="tag">clickhouse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloud/" rel="tag">cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/container/" rel="tag">container</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deepin/" rel="tag">deepin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/" rel="tag">elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsraech/" rel="tag">elasticsraech</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/" rel="tag">es6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flyio/" rel="tag">flyio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gdal/" rel="tag">gdal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitlab/" rel="tag">gitlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gnome/" rel="tag">gnome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo%E4%B8%BB%E9%A2%98/" rel="tag">hexo主题</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/intellj/" rel="tag">intellj</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdk/" rel="tag">jdk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jenkins/" rel="tag">jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kibana/" rel="tag">kibana</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernetes/" rel="tag">kubernetes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kuboard/" rel="tag">kuboard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mail/" rel="tag">mail</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nas/" rel="tag">nas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/no-ad/" rel="tag">no_ad</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/onedrive/" rel="tag">onedrive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orientDb/" rel="tag">orientDb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/post/" rel="tag">post</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgres/" rel="tag">postgres</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/put/" rel="tag">put</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/repost/" rel="tag">repost</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spotify/" rel="tag">spotify</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springcloud/" rel="tag">springcloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime/" rel="tag">sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thunderbolt/" rel="tag">thunderbolt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vmware/" rel="tag">vmware</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vpn/" rel="tag">vpn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-cli/" rel="tag">vue-cli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webdav/" rel="tag">webdav</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wine/" rel="tag">wine</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yandex/" rel="tag">yandex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zsh/" rel="tag">zsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E6%92%AD/" rel="tag">云播</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" rel="tag">内网穿透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A0%E9%80%9F/" rel="tag">加速</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9D%9A%E6%9E%9C%E4%BA%91/" rel="tag">坚果云</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E5%90%8D/" rel="tag">域名</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A9%E7%BF%BC%E4%BA%91/" rel="tag">天翼云</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%A8%E8%8D%90/" rel="tag">推荐</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%90%9C%E7%8B%97%E8%BE%93%E5%85%A5%E6%B3%95/" rel="tag">搜狗输入法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%90%AC%E5%AE%B6/" rel="tag">搬家</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag">树莓派</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/" rel="tag">知识管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%AB%99/" rel="tag">网站</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%85%BE%E8%AE%AF%E4%BA%91/" rel="tag">腾讯云</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%86%E9%A2%91%E6%B5%81/" rel="tag">视频流</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B5%84%E6%BA%90/" rel="tag">资源</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6/" rel="tag">软件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E9%85%8D%E7%BD%AE/" rel="tag">软件配置</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1/" rel="tag">邮件服务</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://imlike.cc/page.html">镜像网站导航</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://imcyc.cn/">Morty</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">平时零散的知识</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="https://pic.superbed.cn/item/5c9f2d213a213b04176522d4" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:s@yandex.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/bigleek" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa Google" target="_blank" href="https://plus.google.com/bigleekcode" title="Google"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-pgsql调优转载" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/3990369431.html" class="article-date">
      <time datetime="2022-04-13T07:11:42.000Z" itemprop="datePublished">2022-04-13</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/3990369431.html">pgsql调优转载</a>
    </h1>
  

      </header>
      
    
        <div class="article-entry" itemprop="articleBody">
          
                
                            
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                            
                                
                                <p><p>2022-4-13 更新—————-</p>
<p><img src="../img/image-20220413200329988.png" alt="image-20220413200329988"></p>
<p>select * from pg_tables where tablename like ‘pg_temp%’;</p>
<p>
                              
                          
                    
              <!-- 
              
              <p>2022-4-13 更新—————-</p>
<p><img src="../img/image-20220413200329988.png" alt="image-20220413200329988"></p>
<p>select * from pg_tables where tablename like ‘pg_temp%’;</p>
<p>不会有对应的表</p>
<p>select * from pg_namespace where nspname like ‘pg%temp%’;</p>
<p>但是会床创建临时的scheme</p>
<p>持续更新 —————————–</p>
<p><a target="_blank" rel="noopener" href="http://postgres.cn/docs/10/monitoring-stats.html#PG-STAT-ALL-TABLES-VIEW">官方文档</a></p>
<p>根据进程可以查询命令执行的时间和效率</p>
<ul>
<li>查询耗时</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT procpid, START, now() - START AS lap, current_query  FROM ( SELECT backendid, pg_stat_get_backend_pid (S.backendid) AS procpid,</span><br><span class="line">pg_stat_get_backend_activity_start (S.backendid) AS START,pg_stat_get_backend_activity (S.backendid) AS current_query  FROM (SELECT</span><br><span class="line">pg_stat_get_backend_idset () AS backendid) AS S) AS S WHERE current_query &lt;&gt; &#39;&lt;IDLE&gt;&#39;  and procpid&#x3D;58762  ORDER BY lap DESC;</span><br></pre></td></tr></table></figure>

<ul>
<li>查询连接 查询进程</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM pg_stat_activity  where pid&#x3D;&#x3D;?? and  query &#x3D;?? and </span><br></pre></td></tr></table></figure>

<ul>
<li>pg_stat_statements</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">修改postgresql.conf的shared_preload_libraries增加pg_stat_statements来载入</span><br><span class="line"></span><br><span class="line">③执行SQL启动插件：create extension pg_stat_statements;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>重置计数器（可选操作）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select pg_stat_reset();</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select pg_stat_statements_reset();</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用命令查看最耗时的SQL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from pg_stat_statements order by total_time desc limit 5;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询读取Buffer次数最多的SQL，buffer次数多，可能是因为没有索引，也同时导致了cpu高。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from pg_stat_statements order by shared_blks_hit+shared_blks_read desc limit 5;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>获取后面的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">select to_char(trigger_start_time,&#39;YYYY-MM-DD 00:00:00&#39;)</span><br><span class="line">        as timePoint,sum(trigger_count) as totalCount from network_attack</span><br><span class="line">        where</span><br><span class="line">        trigger_start_time &gt;&#x3D; to_timestamp($1,&#39;yyyy-MM-dd hh24:mi:ss&#39;)</span><br><span class="line">        and trigger_start_time &lt;  to_timestamp($2,&#39;yyyy-MM-dd hh24:mi:ss&#39;)</span><br><span class="line">        group by timePoint</span><br><span class="line">        order by timePoint desc</span><br><span class="line">relid    oid    一个表的 OID</span><br><span class="line">schemaname    name    这个表所在的模式的名称</span><br><span class="line">relname    name    这个表的名称</span><br><span class="line">seq_scan    bigint    在这个表上发起的顺序扫描的次数</span><br><span class="line">seq_tup_read    bigint    被顺序扫描取得的活着的行的数量</span><br><span class="line">idx_scan    bigint    在这个表上发起的索引扫描的次数</span><br><span class="line">idx_tup_fetch    bigint    被索引扫描取得的活着的行的数量</span><br><span class="line">n_tup_ins    bigint    被插入的行数</span><br><span class="line">n_tup_upd    bigint    被更新的行数（包括 HOT 更新的行）</span><br><span class="line">n_tup_del    bigint    被删除的行数</span><br><span class="line">n_tup_hot_upd    bigint    被更新的 HOT 行数（即不要求独立索引更新的行更新）</span><br><span class="line">n_live_tup    bigint    活着的行的估计数量</span><br><span class="line">n_dead_tup    bigint    死亡行的估计数量</span><br><span class="line">n_mod_since_analyze    bigint    从这个表最后一次被分析后备修改的行的估计数量</span><br><span class="line">last_vacuum    timestamp with time zone    上次这个表被手动清理的时间（不统计VACUUM FULL）</span><br><span class="line">last_autovacuum    timestamp with time zone    上次这个表被自动清理守护进程清理的时间</span><br><span class="line">last_analyze    timestamp with time zone    上次这个表被手动分析的时间</span><br><span class="line">last_autoanalyze    timestamp with time zone    上次这个表被自动清理守护进程分析的时间</span><br><span class="line">vacuum_count    bigint    这个表已被手工清理的次数（不统计VACUUM FULL）</span><br><span class="line">autovacuum_count    bigint    这个表已被自动清理守护进程清理的次数</span><br><span class="line">analyze_count    bigint    这个表已被手工分析的次数</span><br><span class="line">autoanalyze_count    bigint    这个表已被自动清理守护进程分析的次数</span><br></pre></td></tr></table></figure>

<p>seq_tup_read 远大于 idx_tup_fetch 说明索引建的有问题</p>
<p>n_tup_upd 说明有频繁更新的动作</p>

               -->
        </div>
        
    
    <div class="article-info article-info-index">
      
      

      <!--  -->


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-maven 从pom.xml 下载jar包" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/1868978831.html" class="article-date">
      <time datetime="2022-04-12T05:12:35.000Z" itemprop="datePublished">2022-04-12</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/1868978831.html">maven 从pom.xml 下载jar包</a>
    </h1>
  

      </header>
      
    
        <div class="article-entry" itemprop="articleBody">
          
                
                            
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                            
                                
                                <p><p>打包会有问题</p>
<p>root  lib-A</p>
<p>当前是需要直接打root的jar包，但是lib包下面有直接引用的本地jar并不在maven仓库当中使用如下</p>
<p>
                              
                          
                    
              <!-- 
              
              <p>打包会有问题</p>
<p>root  lib-A</p>
<p>当前是需要直接打root的jar包，但是lib包下面有直接引用的本地jar并不在maven仓库当中使用如下</p>
<p>格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.shentong<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pinyinAnalyzer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;pom.basedir&#125;/src/main/resources/lib/pinyinAnalyzer4.3.1.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>打包中如果有测试代码编译不通过的可用参考添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">testFailureIgnore</span>&gt;</span>true<span class="tag">&lt;/<span class="name">testFailureIgnore</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我后面发现打的jar包lib文件夹下面的确是有lib-A项目，但是啊就是跑的后面一旦涉及引用lib-A下面的本地第三方jar就说类找不到网上有人给出如下解决方案</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">includeSystemScope</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeSystemScope</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我分别在lib-A和root项目下添加了，神奇的事发生了，打包的后服务可以运行，但是lib-A下面的controller全都没有，对应的请求都是404，人都快裂开了</p>
<p>只能排除法先注释root下发现不行，后面注释lib-A下居然成功了，真TMD邪门</p>
<p>补充maven install 包含外部jar的打包情况——-</p>
<p>参考链接</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5597099/maven-add-jars-through-systempath-system-but-not-added-to-war-or-anywhere-else/5597277">java - Maven add jars through systemPath/system but not added to war or anywhere else - Stack Overflow</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/lyd135364/article/details/90664373">Maven package 时出现should not point at files within the project directory_隐0士的博客-CSDN博客</a></li>
</ul>
<p>在maven的pom文件中引用本地的jar</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.belerweb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pinyin4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;scope&gt;system&lt;/scope&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;systemPath&gt;$&#123;project.basedir&#125;/src/main/resources/lib/pinyin4j-2.5.0.jar&lt;/systemPath&gt;--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;pom.basedir&#125;/src/main/resources/lib/pinyin4j-2.5.1.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但是打包时会报错</p>
<blockquote>
<p>should not point at files within the project directory dependencies.dependency.systemPath</p>
</blockquote>
<p>在stackoverflow上有两种方式</p>
<p>第一种是pom中添加jar所在文件夹的仓库</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">id</span>&gt;</span>localrepository<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">url</span>&gt;</span>file://$&#123;project.basedir&#125;/src/main/resources/lib<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但是在打包的时候还是会出问题</p>
<p>第二种使用plugin来实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-install-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                     <span class="comment">&lt;!-- &lt;goals&gt;</span></span><br><span class="line"><span class="comment">                          &lt;goal&gt;copy-dependencies&lt;/goal&gt;</span></span><br><span class="line"><span class="comment">                      &lt;/goals&gt;--&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.belerweb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pinyin4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                          <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">                          <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;pom.basedir&#125;/src/main/resources/lib/pinyinAnalyzer4.3.1.jar<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>tips 下面的两种尝试过失败也列出来</p>
<ol>
<li><p>使用configuration复制来自于网络和正确的配置有出入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">id</span>&gt;</span>pinyin4j<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;pom.basedir&#125;/src/main/resources/lib/pinyin4j-2.5.0.jar<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">repositoryLayout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">repositoryLayout</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.belerweb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pinyin4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">generatePom</span>&gt;</span>true<span class="tag">&lt;/<span class="name">generatePom</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;<span class="name">goal</span>&gt;</span>pinyin4j<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>使用<phase>clean</phase></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">id</span>&gt;</span>pinyinAnalyzer<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">phase</span>&gt;</span>clean<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;pom.basedir&#125;/src/main/resources/lib/pinyinAnalyzer4.3.1.jar<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">repositoryLayout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">repositoryLayout</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.shentong<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pinyinAnalyzer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">generatePom</span>&gt;</span>true<span class="tag">&lt;/<span class="name">generatePom</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;<span class="name">goal</span>&gt;</span>install-file<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="3">
<li><p>使用phase&gt;init&lt;/phase</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">id</span>&gt;</span>pinyinAnalyzer<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">phase</span>&gt;</span>init<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;pom.basedir&#125;/src/main/resources/lib/pinyinAnalyzer4.3.1.jar<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">repositoryLayout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">repositoryLayout</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.shentong<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pinyinAnalyzer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">generatePom</span>&gt;</span>true<span class="tag">&lt;/<span class="name">generatePom</span>&gt;</span></span><br><span class="line">                   hconfiguration&gt;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;<span class="name">goal</span>&gt;</span>install-file<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br></pre></td></tr></table></figure>













</li>
</ol>
<p> 之前一直用IntelliJ IDEA 的直接下载jar包,但是这次一直下载不下来指定版本jar包,看本地的代码库localRepository本地没有,看本地部署的maven中心,所以使用了<a target="_blank" rel="noopener" href="https://blog.csdn.net/u011561335/article/details/80322960">参考地址</a></p>
<ol>
<li>创建pom.xml 文件</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>Spider<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Spider<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>使用mvn命令 下载后在本地仓库看到, 然后在IntelliJ IDEA刷新</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:copy-dependencies</span><br></pre></td></tr></table></figure>


               -->
        </div>
        
    
    <div class="article-info article-info-index">
      
      

      <!-- 
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maven/" rel="tag">maven</a></li></ul>
    </div>
 -->


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-cloudflare的DNS解析和page服务以及转发到指定ip地址" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/a4faf5d1.html" class="article-date">
      <time datetime="2022-04-09T14:16:10.000Z" itemprop="datePublished">2022-04-09</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/a4faf5d1.html">cloudflare的DNS解析和page服务以及转发到指定ip地址</a>
    </h1>
  

      </header>
      
    
        <div class="article-entry" itemprop="articleBody">
          
                
                            
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                            
                          
                    
              <!-- 
              
              <p><img src="../img/image-20220409221655871.png" alt="image-20220409221655871"></p>
<p><a target="_blank" rel="noopener" href="https://developers.cloudflare.com/ssl/origin-configuration/origin-ca/#:~:text=Some%20origin%20web%20servers%20require%20upload%20of%20the%20Cloudflare%20Origin%20CA%20root%20certificate.%20Click%20a%20link%20below%20to%20download%20either%20an%20RSA%20and%20ECC%20version%20of%20the%20Cloudflare%20Origin%20CA%20root%20certificate%3A">Origin CA certificates · Cloudflare SSL docs</a></p>

               -->
        </div>
        
    
    <div class="article-info article-info-index">
      
      

      <!--  -->


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-安卓推送消息" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/514a98ba.html" class="article-date">
      <time datetime="2022-04-05T08:45:32.000Z" itemprop="datePublished">2022-04-05</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/514a98ba.html">安卓推送消息</a>
    </h1>
  

      </header>
      
    
        <div class="article-entry" itemprop="articleBody">
          
                
                            
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                            
                                
                                <p><p>目前想给自己的手机客户端推送消息和提醒，之前一直用的是 <a target="_blank" rel="noopener" href="https://wxpusher.zjiecode.com/docs/#/">WxPusher微信推送服务</a>,</p>
<p><a target="_blank" rel="noopener" href="https://sct.ftqq.com/">Server酱·Turbo版</a>，通过关注指定的微信公众号来实现微信提醒，原理图如下</p>
<p><img src="../img/20210205122635.png" alt="img"></p>
<p>
                              
                          
                    
              <!-- 
              
              <p>目前想给自己的手机客户端推送消息和提醒，之前一直用的是 <a target="_blank" rel="noopener" href="https://wxpusher.zjiecode.com/docs/#/">WxPusher微信推送服务</a>,</p>
<p><a target="_blank" rel="noopener" href="https://sct.ftqq.com/">Server酱·Turbo版</a>，通过关注指定的微信公众号来实现微信提醒，原理图如下</p>
<p><img src="../img/20210205122635.png" alt="img"></p>
<p>但是微信始终有缺陷，我一直在考虑有没有一直利用现有的安卓和苹果推送的壳APP，然后调用接口推送消息到客户端。</p>
<p><a target="_blank" rel="noopener" href="http://pushdeer.com/">pushdeer.com</a></p>
<h3 id="设置设备"><a href="#设置设备" class="headerlink" title="设置设备"></a>设置设备</h3><p><img src="../img/image-20220405171122231.png" alt="image-20220405171122231"></p>
<h3 id="设置key"><a href="#设置key" class="headerlink" title="设置key"></a>设置key</h3><p><img src="../img/image-20220405171137973.png" alt="image-20220405171137973"></p>
<h3 id="开启APP的通知权限"><a href="#开启APP的通知权限" class="headerlink" title="开启APP的通知权限"></a>开启APP的通知权限</h3><p><img src="../img/9608ca3e7a10e6c41f8ee7ae86c67100.jpg" alt="9608ca3e7a10e6c41f8ee7ae86c67100"></p>
<h3 id="输入推送消息"><a href="#输入推送消息" class="headerlink" title="输入推送消息"></a>输入推送消息</h3><p><img src="../img/image-20220405171059460.png" alt="image-20220405171059460"></p>

               -->
        </div>
        
    
    <div class="article-info article-info-index">
      
      

      <!--  -->


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-nginx详细的配置和用途" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2474801124.html" class="article-date">
      <time datetime="2022-03-23T18:51:11.000Z" itemprop="datePublished">2022-03-24</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2474801124.html">nginx详细的配置和用途</a>
    </h1>
  

      </header>
      
    
        <div class="article-entry" itemprop="articleBody">
          
                
                            
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                            
                                
                                <p><p>2022-03-23补充————<br>后置代理和从定向</p>
<p> location /api/test.html {</p>
<h1 id="return-301-http-8-136-132-68-8081-404-html"><a href="#return-301-http-8-136-132-68-8081-404-html" class="headerlink" title="return 301 http://8.136.132.68:8081/404.html;"></a>return 301 <a target="_blank" rel="noopener" href="http://8.136.132.68:8081/404.html">http://8.136.132.68:8081/404.html</a>;</h1><pre><code>return 301 $scheme://$host:$server_port/404.html;
<p>
                              
                          
                    
              <!-- 
              
              <p>2022-03-23补充————<br>后置代理和从定向</p>
<p> location /api/test.html {</p>
<h1 id="return-301-http-8-136-132-68-8081-404-html"><a href="#return-301-http-8-136-132-68-8081-404-html" class="headerlink" title="return 301 http://8.136.132.68:8081/404.html;"></a>return 301 <a target="_blank" rel="noopener" href="http://8.136.132.68:8081/404.html">http://8.136.132.68:8081/404.html</a>;</h1><pre><code>return 301 $scheme://$host:$server_port/404.html;
&#125;</code></pre>
<p>location /stg/swagger-ui.html {<br>            proxy_pass  http://$host:$server_port/404.html;</p>
<p>}</p>
<p>2022-1-20———————</p>
<p><a target="_blank" rel="noopener" href="https://mincong.io/cn/nginx-subdomains/">在 Nginx 中配置二级域名 - Mincong Huang</a></p>
<p>目前ss证书都是<strong>Let’s Encrypt</strong> 和cloudflare</p>
<p>,<img src="../img/image-20220123144802723.png" alt="image-20220123144802723"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">  # 配置证书地址</span><br><span class="line">  ssl_certificate      &#x2F;etc&#x2F;nginx&#x2F;imlike.cc.pem;</span><br><span class="line">  ssl_certificate_key  &#x2F;etc&#x2F;nginx&#x2F;imlike.cc.key;</span><br><span class="line">     server&#123;</span><br><span class="line">              listen       443 ssl http2;</span><br><span class="line">              listen       [::]:443 ssl http2;</span><br><span class="line">              server_name  _;</span><br><span class="line">               location &#x2F; &#123;</span><br><span class="line">               # 一些基本反向代理配置以及获取请求真是IP地址</span><br><span class="line">                      proxy_redirect off;</span><br><span class="line">                      proxy_set_header Host $host;</span><br><span class="line">                      proxy_set_header X-Real-Ip $remote_addr;</span><br><span class="line">                      proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">                      proxy_pass http:&#x2F;&#x2F;8.136.132.68:5212&#x2F;;</span><br><span class="line">              &#125;</span><br><span class="line">             # access_log &#x2F;home&#x2F;wwwlogs&#x2F;git.aboutme.ink.log;</span><br><span class="line">       &#125;</span><br><span class="line">   # 监听80端口,提供本地静态服务</span><br><span class="line">  server &#123;</span><br><span class="line">      listen       80;</span><br><span class="line">      server_name  localhost;</span><br><span class="line"></span><br><span class="line">      #charset koi8-r;</span><br><span class="line"></span><br><span class="line">      #access_log  logs&#x2F;host.access.log  main;</span><br><span class="line"></span><br><span class="line">      location &#x2F; &#123;</span><br><span class="line">          root   &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;</span><br><span class="line">          index  index.html index.htm;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 监听80的配置 跳转到对应HTTPS</span><br><span class="line">server &#123;</span><br><span class="line">  listen       80;</span><br><span class="line">  server_name  _;</span><br><span class="line">  return       301 https:&#x2F;&#x2F;$host$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>如果出现下图的问题,需要看看后置代理的服务是否有问题和nginx日志</p>
<p><img src="../img/image-20220120172354834.png" alt="image-20220120172354834"></p>
<blockquote>
<p>curl -iL file.imlike.cc</p>
</blockquote>
<p>2021-12-31补充</p>
<p><img src="../img/image-20211231134646924.png" alt="image-20211231134646924"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gzip on;  #是否开启gzip模块 on表示开启 off表示关闭</span><br><span class="line">    gzip_static on;</span><br><span class="line">gzip_buffers 4 16k;  #设置压缩所需要的缓冲区大小</span><br><span class="line">gzip_comp_level 6;  #压缩级别1-9，数字越大压缩的越好，也越占用CPU时间</span><br><span class="line">gzip_min_length 1k;  #设置允许压缩的最小字节</span><br><span class="line">gzip_http_version 1.0;  #设置压缩http协议的版本,默认是1.1</span><br><span class="line">gzip_types text&#x2F;plain application&#x2F;x-javascript text&#x2F;css text&#x2F;javascript application&#x2F;x-httpd-php image&#x2F;jpeg image&#x2F;gif image&#x2F;png application&#x2F;octet-stream application&#x2F;javascript;  #设置压缩的文件类型</span><br><span class="line">gzip_vary     on;  #加上http头信息Vary: Accept-Encoding给后端代理服务器识别是否启用 gzip 压缩</span><br></pre></td></tr></table></figure>







<p>2021-12-17补充使用nginx来代理并替换内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;uu&#x2F; &#123;</span><br><span class="line"># 添加gzip的支持 否则geoserver返回的内容不能被替换</span><br><span class="line"> proxy_set_header Accept-Encoding &quot;&quot;;</span><br><span class="line"> # 你想要代理的地址</span><br><span class="line">     proxy_pass http:&#x2F;&#x2F;192.168.11.20:8080&#x2F;geoserver&#x2F;;</span><br><span class="line"></span><br><span class="line">   # sub_filter_types text&#x2F;html;</span><br><span class="line">   # 参数分别为 on(一次),off(全部替换)</span><br><span class="line">      sub_filter_once off;</span><br><span class="line">      # 需要替换的内容,就是网页的内容 </span><br><span class="line">     sub_filter &#39;http:&#x2F;&#x2F;127.0.0.1&#x2F;geoserver&#x2F;&#39; &#39;http:&#x2F;&#x2F;127.0.0.1:8088&#x2F;uu&#x2F;&#39;;</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      proxy_redirect     default;</span><br><span class="line"></span><br><span class="line">       # 返回重定向的</span><br><span class="line">        # proxy_set_header   Host $host;</span><br><span class="line">        # proxy_set_header Host $host:$server_port;</span><br><span class="line">        # proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>



<p>tips</p>
<ul>
<li>nginx -V 查看是否支持 http_sub_module 否则不会替换</li>
<li>sub_filter 只支持替换,不支持正则表达式,复杂的需要使用第三方的库</li>
<li>{IP}:{PORT}/uu/ 才能被识别 但是geoserver通常访问是 xxx/geoserver/web 所以代理后是 xxx/uu/web/ 否则跳转不过去</li>
</ul>
<p>2021-08-20 补充nginx使用和配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">重定向后找不到 host&#x2F;uu&#x2F;geoserver -&gt; host&#x2F;uu&#x2F;geoserver&#x2F;web&#x2F; -&gt;  host&#x2F;uu&#x2F;geoserver&#x2F;index.html</span><br><span class="line">&#x2F; 是相对路径 没有 &#x2F; 绝对路径</span><br><span class="line"></span><br><span class="line">配置文件</span><br><span class="line">    location &#x2F;uts&#x2F; &#123;</span><br><span class="line">          proxy_pass http:&#x2F;&#x2F;192.168.11.20:90&#x2F;uu&#x2F;;</span><br><span class="line">          proxy_redirect default;</span><br><span class="line">          proxy_set_header   Host $host;</span><br><span class="line">        &#125;</span><br><span class="line">        location &#x2F;uu&#x2F; &#123;</span><br><span class="line"></span><br><span class="line">         sub_filter_once off;</span><br><span class="line">         # sub_filter_types text&#x2F;html;</span><br><span class="line">          sub_filter &quot;http:&#x2F;&#x2F;192.168.11.20:8080&#x2F;geoserver&#x2F;&quot; &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;uu&#x2F;&quot;;</span><br><span class="line"></span><br><span class="line">          proxy_pass http:&#x2F;&#x2F;192.168.11.20:8080&#x2F;geoserver&#x2F;;</span><br><span class="line">          proxy_redirect     default;</span><br><span class="line"></span><br><span class="line">          # 返回重定向的</span><br><span class="line">           # proxy_set_header   Host $host;</span><br><span class="line">           # proxy_set_header Host $proxy_host;</span><br><span class="line">           # proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">           # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">location &#x2F;uts &#123;</span><br><span class="line">  proxy_host 192.168.11.20:8080</span><br><span class="line">&#125; http:&#x2F;&#x2F;127.0.0.1&#x2F;uts&#x2F;  &#x2F;uts&#x2F;   http:&#x2F;&#x2F;127.0.0.1&#x2F;uts&#x2F;configDetail     &#x2F;uts&#x2F;configDetail</span><br><span class="line"></span><br><span class="line">location &#x2F;uts&#x2F; &#123;</span><br><span class="line">  proxy_host 192.168.11.20:8080&#x2F;</span><br><span class="line">&#125;  http:&#x2F;&#x2F;127.0.0.1&#x2F;uts&#x2F;  &#x2F;   http:&#x2F;&#x2F;127.0.0.1&#x2F;uts&#x2F;configDetail    configDetail</span><br><span class="line"></span><br><span class="line">location &#x2F;uts&#x2F; &#123;</span><br><span class="line">  proxy_host 192.168.11.20:8080&#x2F;ss&#x2F;</span><br><span class="line">&#125;  http:&#x2F;&#x2F;127.0.0.1&#x2F;uts&#x2F;  &#x2F;   http:&#x2F;&#x2F;127.0.0.1&#x2F;uts&#x2F;configDetail    configDetail</span><br><span class="line"></span><br><span class="line">location &#x2F;uts&#x2F; &#123;</span><br><span class="line">  proxy_host 192.168.11.20:8080</span><br><span class="line">&#125; http:&#x2F;&#x2F;127.0.0.1&#x2F;uts&#x2F;  &#x2F;uts&#x2F;   http:&#x2F;&#x2F;127.0.0.1&#x2F;uts&#x2F;configDetail    &#x2F;uts&#x2F;configDetail</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">location &#x2F;uts &#123;</span><br><span class="line">  proxy_host 192.168.11.20:8080&#x2F;</span><br><span class="line">&#125; http:&#x2F;&#x2F;127.0.0.1&#x2F;uts&#x2F;  &#x2F;&#x2F;   http:&#x2F;&#x2F;127.0.0.1&#x2F;uts&#x2F;configDetail    &#x2F;&#x2F;configDetail</span><br></pre></td></tr></table></figure>









<p>2021-7-29补充</p>
<p>root alias区别</p>
<p>同样配置nginx目录</p>
<p>alias的路径只用于 url 不会根据这个去,    其配置的文件夹来找寻具体目录地址,同时如果在alias的根路径下还会显示 路径下所有文件.相当于 alias设置虚拟目录</p>
<p>但是root不是它会匹配,同样的如果root配置的location对应 文件夹不存在那就会包404</p>
<p>借鉴下面博文<a target="_blank" rel="noopener" href="https://www.cnblogs.com/kevingrace/p/6187482.html">https://www.cnblogs.com/kevingrace/p/6187482.html</a></p>
<blockquote>
<p>1）alias指定的目录是准确的，即location匹配访问的path目录下的文件直接是在alias目录下查找的；<br>2）root指定的目录是location匹配访问的path目录的上一级目录,这个path目录一定要是真实存在root指定目录下的；<br>3）使用alias标签的目录块中不能使用rewrite的break（具体原因不明）；另外，alias指定的目录后面必须要加上”/“符号！！<br>4）alias虚拟目录配置中，location匹配的path目录如果后面不带”/“，那么访问的url地址中这个path目录后面加不加”/“不影响访问，访问时它会自动加上”/“；<br>  但是如果location匹配的path目录后面加上”/“，那么访问的url地址中这个path目录必须要加上”/“，访问时它不会自动加上”/“。如果不加上”/“，访问就会失败！<br>5）root目录配置中，location匹配的path目录后面带不带”/“，都不会影响访问。</p>
<p>举例说明（比如nginx配置的域名是<a href="http://www.wangshibo.com）：">www.wangshibo.com）：</a><br>示例一<br>location /huan/ {<br>   alias /home/www/huan/;<br>}</p>
<p>在上面alias虚拟目录配置下，访问<a target="_blank" rel="noopener" href="http://www.wangshibo.com/huan/a.html%E5%AE%9E%E9%99%85%E6%8C%87%E5%AE%9A%E7%9A%84%E6%98%AF/home/www/huan/a.html%E3%80%82">http://www.wangshibo.com/huan/a.html实际指定的是/home/www/huan/a.html。</a><br>注意：alias指定的目录后面必须要加上”/“，即/home/www/huan/不能改成/home/www/huan</p>
<p>上面的配置也可以改成root目录配置，如下，这样nginx就会去/home/www/huan下寻找<a target="_blank" rel="noopener" href="http://www.wangshibo.com/huan%E7%9A%84%E8%AE%BF%E9%97%AE%E8%B5%84%E6%BA%90%EF%BC%8C%E4%B8%A4%E8%80%85%E9%85%8D%E7%BD%AE%E5%90%8E%E7%9A%84%E8%AE%BF%E9%97%AE%E6%95%88%E6%9E%9C%E6%98%AF%E4%B8%80%E6%A0%B7%E7%9A%84%EF%BC%81">http://www.wangshibo.com/huan的访问资源，两者配置后的访问效果是一样的！</a><br>location /huan/ {<br>    root /home/www/;<br>}</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://blackwolfsec.cc/2018/05/23/Nginx_alias_misconfig_path_traversle/">http://blackwolfsec.cc/2018/05/23/Nginx_alias_misconfig_path_traversle/</a> 借鉴下</p>
<p><img src="../img/20190418163927-79fddd08-61b5-1.png" alt="img"></p>
<p>补充域名相关的知识</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">www.xxx.com&#96; ,&#96;www.zzz.xxx.com&#96;,&#96;www.xxx.com&#x2F;getName</span><br></pre></td></tr></table></figure>

<blockquote>
<p>www: World Wide Web 万维网</p>
<p>xxx: 注册的名称</p>
<p>zzz: 子域名(Second-level domain；英文缩写：SLD)</p>
<p>com:顶级域名(Top-level domains)是org,</p>
<p>URL: <a target="_blank" rel="noopener" href="http://www.example.net/index.html,www.xxx.com/getName">http://www.example.net/index.html,www.xxx.com/getName</a></p>
</blockquote>
<p>对于第三个需要配置 server-&gt;多个location配置</p>
<p>对于第二中需要配置多个server,或者server-&gt;server_name</p>
<p>转载地址<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/36148885">nginx 常用配置记录-知乎专栏</a></p>
<hr>
<h3 id="server模块"><a href="#server模块" class="headerlink" title="server模块"></a><strong>server模块</strong></h3><p>server模块是http的子模块，它用来定义一个虚拟主机</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name localhost www.example.com;</span><br><span class="line">    root        &#x2F;Users&#x2F;yangyi&#x2F;www;# 全局定义，表示在该server下web的根目录</span><br><span class="line">    client_max_body_size 100M;</span><br><span class="line">    keepalive_timeout 20;</span><br><span class="line">    index       index.php index.html index.htm; </span><br><span class="line">    charset     utf-8;</span><br><span class="line">    access_log  logs&#x2F;host.access.log  main; #用来指定此虚拟主机的访问日志存放路径，输出格式为main。</span><br><span class="line">    error_log   logs&#x2F;host.error.log  error; #错误日志存放路径，输出格式为error。</span><br><span class="line">    error_page  404  &#x2F;404.html; #状态码为404时的时候的网页地址,还可定义500,502之类的</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上一些配置为在该server下具有全局性，例如 root，可在location中重新定义root</p>
<h2 id="关于server-name"><a href="#关于server-name" class="headerlink" title="关于server_name"></a>关于server_name</h2><blockquote>
<p>用来指定IP地址或者域名，多个域名之间用空格分开</p>
</blockquote>
<p>当我们想定义多个server监听同一个端口但访问的host不一样时，server_name就派上用场了。nginx会根据HTTP请求的header Host选择nginx配置文件里符合条件的server_name的server配置</p>
<p>匹配顺序如下</p>
<ol>
<li>完全匹配的server_name;</li>
<li>后缀匹配: *.example.com;</li>
<li>前缀匹配: <a target="_blank" rel="noopener" href="http://www.example.*/">www.example.*</a>;</li>
<li>正则匹配: ~\w+.com;</li>
<li>listen指令里配置了default或default_server的server;如｀listen 80 default｀</li>
<li>第一个匹配上listen的server。</li>
</ol>
<p>所以当我们监听的的端口只有一个server配置的时候，server_name 可以不填</p>
<h2 id="关于root和alias的区别"><a href="#关于root和alias的区别" class="headerlink" title="关于root和alias的区别"></a>关于root和alias的区别</h2><p>两者作用差不多，区别在于最终映射的地址不同，例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;request_path&#x2F;image&#x2F; &#123;</span><br><span class="line">    # 如果现在访问 &#x2F;request_path&#x2F;image&#x2F;a&#x2F;b.jpg,root映</span><br><span class="line">    # 射的地址为&#x2F;local_path&#x2F;image&#x2F;request_path&#x2F;image&#x2F;a&#x2F;b.jpg,</span><br><span class="line">    # 而alias为&#x2F;local_path&#x2F;image&#x2F;a&#x2F;b.jpg</span><br><span class="line">    root    &#x2F;local_path&#x2F;image&#x2F;;</span><br><span class="line">    alias   &#x2F;local_path&#x2F;image&#x2F;; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="关于error-page"><a href="#关于error-page" class="headerlink" title="关于error_page"></a>关于error_page</h2><p>语法：error_page code … [=[response]] uri<br>使用字段: http, server, location, if in location</p>
<p>产生的效果为内部跳转(internal redirect)，即用户页面地址不变，但内容实际上为设置的uri对应的内容<br>我们也可以自定义设置返回的状态码，如：<br>error_page 502 503 =200 /50x.html;<br>这样用户访问产生502 、503的时候给用户的返回状态是200，内容是50x.html。<br>还有一种写法是 <code>=</code> 后面不带状态码，是针对相应的内容不是一个静态的页面，最终返回的状态码取决于对应url服务返回的状态码。</p>
<h2 id="location模块"><a href="#location模块" class="headerlink" title="location模块"></a>location模块</h2><blockquote>
<p>最主要和最复杂的配置，通过定位和解析url，判断该选择什么配置，支持正则和条件判断；</p>
</blockquote>
<p>简单例子，匹配所有请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F; &#123;</span><br><span class="line">    root   &#x2F;home&#x2F;www&#x2F;html;</span><br><span class="line">    index  index.php index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个正则匹配的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 匹配.php结尾的请求</span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个反向代理的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 匹配到&#x2F;api开头的路由时候，将请求转发到http:&#x2F;&#x2F;192.168.0.1，但是通常不是直接填写地址，而是设置一个&#96;upstream&#96;配置，后面会提到</span><br><span class="line">location &#x2F;api &#123;</span><br><span class="line">    proxy_pass  http:&#x2F;&#x2F;192.168.0.1; #请求转向地址192.168.0.1</span><br><span class="line">    #不修改被代理服务器返回的响应头中的location头</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    #使用nginx反向代理后，如果要使服务获取真实的用户信息，用以下的设置</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vue-router、react-router等路由框架要开启history模式可以选择的nginx配置的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F; &#123;</span><br><span class="line">  alias     static&#x2F;;</span><br><span class="line">  try_files $uri $uri&#x2F; &#x2F;index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>location的匹配规则和顺序</strong></p>
<ol>
<li>第一种是 <strong>=</strong> 类型，表示精确匹配，优先级最高，一旦匹配到忽略之后的正则匹配</li>
<li><strong>^~</strong> 类型，表示前缀匹配，是字符串开头匹配而非正则匹配，当匹配到该规则时，停止往下面的搜索，所以如果存在两个<strong>^~</strong> 匹配的时候要注意有顺序之分。优先级比正则高。</li>
<li><code>~</code> 和 <code>~*</code>,正则匹配，两者区别是后者不区分大小写。有顺序之分，匹配到第一个正则停止搜索。</li>
<li><code>/uri</code>,普通字符串匹配，无顺序之分，会选择匹配长度最长的配置。</li>
<li><code>/</code> 通用匹配，匹配所有请求</li>
</ol>
<p>还有一种特殊匹配类型 <code>@url</code>，只用于nginx内部跳转，例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F; &#123;</span><br><span class="line">    root &#x2F;var&#x2F;www&#x2F;html;</span><br><span class="line">    error_page 404 @40x;</span><br><span class="line">&#125;</span><br><span class="line">location @40x &#123;</span><br><span class="line">  root &#x2F;var&#x2F;www&#x2F;errors&#x2F;40x.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="upstream模块"><a href="#upstream模块" class="headerlink" title="upstream模块"></a>upstream模块</h2><blockquote>
<p>upstream后端服务器提供简单的负载均衡（轮循调度和客户端 IP）。</p>
</blockquote>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">upstream backend  &#123;</span><br><span class="line">  server backend1.example.com weight&#x3D;5;</span><br><span class="line">  server backend2.example.com:8080;</span><br><span class="line">  server unix:&#x2F;tmp&#x2F;backend3;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">server &#123;</span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    proxy_pass  http:&#x2F;&#x2F;backend;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有常用两种负载均衡支持调度算法，分别是 <strong>weight</strong> 和 <strong>ip_hash</strong> 。weight 模式下可以为每个 server 设置weight值，weight值越大，分配到的访问机率越高，ip_hash 为同一个ip的<br>分配同一个后端服务器，这样我们不用解决session共享问题。</p>
<h2 id="include"><a href="#include" class="headerlink" title="include"></a>include</h2><blockquote>
<p>include指令 使nginx配置更加灵活，将部分配置直接拆分出来,分成不同的配置文件</p>
</blockquote>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http &#123;    include mime.types;    include vhost&#x2F;*.conf; # 虚拟主机配置&#125;</span><br></pre></td></tr></table></figure>

<h2 id="关于-mime-types："><a href="#关于-mime-types：" class="headerlink" title="关于 mime.types："></a>关于 mime.types：</h2><p>mime type 和 文件扩展名的对应关系一般放在 mime.types 里，然后 用 <code>include mime.types</code>;<br>mime.types作用：通过文件的扩展名设置了Content-Type，Nginx如果没找到对应文件的扩展名的话，就使用默认的Type，默认Type通用 <code>default_type</code> 定义，比如 default_type application/octet-stream ;<br>完整的 mime.types 配置：<a href="https://link.zhihu.com/?target=https://github.com/h5bp/server-configs-nginx/blob/master/mime.types">https://github.com/h5bp/server-configs-nginx/blob/master/mime.types</a></p>
<h2 id="关于-vhost-conf"><a href="#关于-vhost-conf" class="headerlink" title="关于 vhost/*.conf :"></a>关于 vhost/*.conf :</h2><p>一个虚拟主机对一个文件配置，放到vhost文件夹下面，然后通过include指令包含进来，这样更便于维护和管理</p>
<h2 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h2><blockquote>
<p>gzip 压缩，用来对静态资源进行压缩，需要客户端同时支持才有效。</p>
</blockquote>
<p>配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    #开启gzip压缩</span><br><span class="line">    gzip  on;</span><br><span class="line">    #IE6的某些版本对gzip的压缩支持很不好,故关闭</span><br><span class="line">    gzip_disable &quot;MSIE [1-6]\.(?!.*SV1)&quot;;</span><br><span class="line">    #HTTP1.0以上的版本都启动gzip</span><br><span class="line">    gzip_http_version 1.0；</span><br><span class="line">    #指定哪些类型的相应才启用gzip压缩，多个用空格分隔</span><br><span class="line">    gzip_types </span><br><span class="line">    application&#x2F;javascript </span><br><span class="line">    application&#x2F;json </span><br><span class="line">    text&#x2F;css </span><br><span class="line">    text&#x2F;plain;</span><br><span class="line">    # 压缩等级，可选1-9，值越大压缩时间越长压缩率越高，</span><br><span class="line">    # 通常选5，能压缩到原来的1&#x2F;4</span><br><span class="line">    gzip_comp_level 5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="rewrite模块（ngx-http-rewrite-mode）"><a href="#rewrite模块（ngx-http-rewrite-mode）" class="headerlink" title="rewrite模块（ngx_http_rewrite_mode）"></a>rewrite模块（ngx_http_rewrite_mode）</h2><p>rewrite模块配合很多模块一起使用，包含几个指令：</p>
<ol>
<li>break</li>
<li>if</li>
<li>return</li>
<li>rewrite</li>
<li>rewrite_log</li>
<li>set</li>
<li>uninitialized_variable_warn</li>
</ol>
<p>这里简单介绍下break、if、return，重点介绍 rewrite</p>
<h2 id="break"><a href="#break" class="headerlink" title="break"></a>break</h2><p>语法: break;<br>使用字段: server, location, if<br>此指令的意思是停止执行当前虚拟主机的后续rewrite指令集</p>
<p>例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 如果访问的文件名不存在，反向代理到localhost 。这里的break也是停止rewrite检查</span><br><span class="line">if (!-f $request_filename) &#123;</span><br><span class="line">    break;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><p>语法: if (condition) { … }<br>使用字段: server, location<br>if 判断一个条件，如果条件成立，则后面的大括号内的语句将执行，相关配置从上级继承。</p>
<p>条件(conditon)可以是如下任何操作：</p>
<ol>
<li>当表达式只是一个变量时，如果值为空或任何以0开头的字符串都会当做false；</li>
<li>使用“=”和“!=”比较一个变量和字符串；</li>
<li>使用“<del>”做正则表达式匹配，“</del>*”做不区分大小写的正则匹配，“!~”做区分大小写的正则不匹配；</li>
<li>使用“-f”和“!-f” 检查一个文件是否存在；</li>
<li>使用“-d”和“!-d”检查一个目录是否存在；</li>
<li>使用“-e”和“!-e”检查一个文件、目录、符号链接是否存在；</li>
<li>使用“-x”和“ !-x”检查一个文件是否可执行；</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 如果提交方法为POST，则返回状态405（Method not allowed）</span><br><span class="line">if ($request_method &#x3D; POST) &#123;</span><br><span class="line">    return 405;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="return"><a href="#return" class="headerlink" title="return"></a>return</h2><p>语法: return code [text];<br>return code URL;<br>return URL;<br>使用字段: server, location, if<br>停止处理并为客户端返回状态码，非标准的444状态码将关闭连接，不发送任何响应头。可以使用的状态码有：204，400，402-406，408，410, 411, 413, 416与500-504。如果状态码附带文字段落，该文本将被放置在响应主体。相反，如果状态码后面是一个URL，该URL将成为location头部值。没有状态码的URL将被视为一个302状态码，这种情况下URL需要以“http://”, “https://”, 或者 “$scheme”开头。</p>
<h2 id="rewrite"><a href="#rewrite" class="headerlink" title="rewrite"></a>rewrite</h2><p>语法: rewrite regex replacement [flag];<br>使用字段: server, location, if<br>使用nginx提供的全局变量或自己设置的变量，然后结合正则表达式和标志位实现url重写以及重定向。多条 rewrite 顺序靠前且匹配的优先执行。可以通过设置 flag 停止继续处理。如果replacement 以“http://”, “https://”, 或者 “$scheme”开头，那么将立即停止处理并临时重定向给客户端。</p>
<p>flag可以是如下参数：</p>
<ul>
<li>last，完成该rewrite规则的执行后，停止处理后续rewrite指令集；然后查找匹配改变后URI的新location；</li>
<li>break，完成该rewrite规则的执行后，停止处理后续rewrite指令集，并不再重新查找；但是当前location内剩余非rewrite语句和location外的的非rewrite语句可以执行；</li>
<li>redirect，返回302临时重定向，地址栏会显示跳转后的地址；</li>
<li>permanent，返回301永久重定向，地址栏会显示跳转后的地址；即表示如果客户端不清理浏览器缓存，那么返回的结果将永久保存在客户端浏览器中了。</li>
</ul>
<p>因为301和302不能简单的只返回状态码，还必须有重定向的URL，这就是return指令无法返回301,302的原因了。两种重定向的方式对客户端来说是一样的，就是重新加载另外一个url。我们在实际设置中推荐只使用永久重定向，因为临时重定向可能造成在url为A页面，但显示的是B页面的内容，造成网址劫持。</p>
<p>比较难以理解的是 last 和 break，让我们先了解 nginx 运行的11个阶段，注意到第四阶段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;  </span><br><span class="line">    NGX_HTTP_POST_READ_PHASE &#x3D; 0,   &#x2F;&#x2F;读取请求头  </span><br><span class="line">  </span><br><span class="line">    NGX_HTTP_SERVER_REWRITE_PHASE,   &#x2F;&#x2F;执行rewrite  </span><br><span class="line">  </span><br><span class="line">    NGX_HTTP_FIND_CONFIG_PHASE,  &#x2F;&#x2F;根据uri替换location  </span><br><span class="line">    NGX_HTTP_REWRITE_PHASE,      &#x2F;&#x2F;根据替换结果继续执行rewrite  </span><br><span class="line">    NGX_HTTP_POST_REWRITE_PHASE, &#x2F;&#x2F;执行rewrite后处理  </span><br><span class="line">  </span><br><span class="line">    NGX_HTTP_PREACCESS_PHASE,    &#x2F;&#x2F;认证预处理   请求限制，连接限制  </span><br><span class="line">  </span><br><span class="line">    NGX_HTTP_ACCESS_PHASE,       &#x2F;&#x2F;认证处理  </span><br><span class="line">    NGX_HTTP_POST_ACCESS_PHASE,  &#x2F;&#x2F;认证后处理， 认证不通过， 丢包  </span><br><span class="line">  </span><br><span class="line">    NGX_HTTP_TRY_FILES_PHASE,    &#x2F;&#x2F;尝试try标签  </span><br><span class="line">    NGX_HTTP_CONTENT_PHASE,      &#x2F;&#x2F;内容处理  </span><br><span class="line">  </span><br><span class="line">    NGX_HTTP_LOG_PHASE           &#x2F;&#x2F;日志处理  </span><br><span class="line">&#125; ngx_http_phases;  </span><br></pre></td></tr></table></figure>

<p>所以我们再来理解last与break的区别：<br>last： 停止当前这个请求，并根据rewrite匹配的规则重新发起一个请求。新请求又从第一阶段开始执行…<br>break：相对last，break并不会重新发起一个请求，只是跳过当前的rewrite阶段，并执行本请求后续的执行阶段…</p>
<p>通过实例会更加清晰的理解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server;</span><br><span class="line">    server_name dcshi.com;</span><br><span class="line">    root www;</span><br><span class="line"></span><br><span class="line">    location &#x2F;break&#x2F; &#123;</span><br><span class="line">        rewrite ^&#x2F;break&#x2F;(.*) &#x2F;test&#x2F;$1 break;</span><br><span class="line">        echo &quot;break page&quot;;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    location &#x2F;last&#x2F; &#123;</span><br><span class="line">         rewrite ^&#x2F;last&#x2F;(.*) &#x2F;test&#x2F;$1 last;</span><br><span class="line">         echo &quot;last page&quot;;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    location &#x2F;test&#x2F; &#123;</span><br><span class="line">       echo &quot;test page&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请求:<a href="https://link.zhihu.com/?target=http://dcshi.com/break/">http://dcshi.com/break/</a>***<br>输出: break page<br>分析：正如上面讨论所说，break是跳过当前请求的rewrite阶段，并继续执行本请求的其他阶段，很明显，对于/foo 对应的content阶段的输出为 echo “break page”; (content阶段，可以简单理解为产生数据输出的阶段，如返回静态页面内容也是在content阶段；echo指令也是运行在content阶段，一般情况下content阶段只能对应一个输出指令，如同一个location配置两个echo，最终只会有一个echo指令被执行)；当然如果你把/break/里的echo 指令注释，然后再次访问/break/xx会报404，这也跟我们预期一样：虽然/break/xx被重定向到/test/xx,但是break指令不会重新开启一个新的请求继续匹配，所以nginx是不会匹配到下面的/test/这个location；在echo指令被注释的情况下，/break/ 这location里只能执行nginx默认的content指令，即尝试找/test/xx这个html页面并输出起内容，事实上，这个页面不存在，所以会报404的错误。</p>
<p>请求: <a href="https://link.zhihu.com/?target=http://dcshi.com/last/">http://dcshi.com/last/</a>***<br>输出: test page<br>分析: last与break最大的不同是，last会重新发起一个新请求，并重新匹配location，所以对于/last,重新匹配请求以后会匹配到/test/,所以最终对应的content阶段的输出是test page;</p>
<p>解释完了 last 和 break ，我们再写一个实例用来说明 rewrite 可以做什么事情。通过rewrite将不带www的请求统一转向为www：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    # ........</span><br><span class="line">    server_name www.abc.com ;&#x2F;&#x2F;只留一个</span><br><span class="line">    # ......</span><br><span class="line">｝</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  server_name  abc.com;</span><br><span class="line">  rewrite ^(.*)$ http:&#x2F;&#x2F;www.abc.com$1 permanent; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">   listen 80;</span><br><span class="line">   server_name abc.com www.abc.com;</span><br><span class="line">   if ( $host !&#x3D; &#39;www.abc.com&#39;  ) &#123;</span><br><span class="line">       rewrite ^&#x2F;(.*) http:&#x2F;&#x2F;www.abc.com&#x2F;$1 permanent;</span><br><span class="line">   &#125;</span><br><span class="line">   location &#x2F; &#123;</span><br><span class="line">       root &#x2F;data&#x2F;www&#x2F;www;</span><br><span class="line">       index index.html index.htm;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a href="https://link.zhihu.com/?target=http://tool.oschina.net/apidocs/apidoc?api=nginx-zh">在线文档-nginx-zh</a></p>
<p><a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/bed000e1830b">WEB请求处理二：Nginx请求反向代理</a></p>
<p><a href="https://link.zhihu.com/?target=http://blog.sina.com.cn/s/blog_4f9fc6e10102ux0w.html">http://blog.sina.com.cn/s/blog_4f9fc6e10102ux0w.html</a></p>

               -->
        </div>
        
    
    <div class="article-info article-info-index">
      
      

      <!-- 
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li></ul>
    </div>
 -->


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-distriubte-file-description" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/ce67ced3.html" class="article-date">
      <time datetime="2022-03-10T07:33:12.000Z" itemprop="datePublished">2022-03-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/ce67ced3.html">分布式文件服务介绍</a>
    </h1>
  

      </header>
      
    
        <div class="article-entry" itemprop="articleBody">
          
                
                            
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                            
                                
                                <p><p><a target="_blank" rel="noopener" href="https://www.ibm.com/cloud/blog/object-vs-file-vs-block-storage">对象、文件和块存储：有什么区别？ | IBM</a></p>
<p><a target="_blank" rel="noopener" href="https://www.netapp.com/data-storage/storagegrid/what-is-object-storage/">什么是对象存储？ - 对象 vs. 文件 vs. 块 | NetApp</a></p>
<p><a target="_blank" rel="noopener" href="https://www.redhat.com/en/topics/data-storage/file-block-object-storage">文件存储、块存储还是对象存储？</a></p>
<p>
                              
                          
                    
              <!-- 
              
              <p><a target="_blank" rel="noopener" href="https://www.ibm.com/cloud/blog/object-vs-file-vs-block-storage">对象、文件和块存储：有什么区别？ | IBM</a></p>
<p><a target="_blank" rel="noopener" href="https://www.netapp.com/data-storage/storagegrid/what-is-object-storage/">什么是对象存储？ - 对象 vs. 文件 vs. 块 | NetApp</a></p>
<p><a target="_blank" rel="noopener" href="https://www.redhat.com/en/topics/data-storage/file-block-object-storage">文件存储、块存储还是对象存储？</a></p>
<p>对象存储 </p>
<p>没有结构的文件可以是图片，日志，视频，音频。所有的对象处于同一层级，没有文件存储那个月的文件夹或者子目录，此外，对象存储不会将所有数据一起存储在一个文件中。对象还包含元数据，这是有关有助于处理和可用性的文件的信息。用户可以使用对象存储设置固定键元数据的值，或者他们可以为与对象关联的自定义元数据创建键和值。</p>
<p>文件存储 role,group,user,promession</p>
<p>文件存储就是原始的，将数据一起保存单个文件中，文件拓展名内心有创建文件和文件类型确定，文件可以存储在NAS(网络附加存储)设备上</p>
<p>块存储</p>
<p>将数据拆分为固定的数据块，使用唯一标识符单独存储，这些块可以存储在不同的环境中，当用户检索一个块时存储系统将这些块重新组合成一个单元，块存储是硬盘驱动器 </p>
<p>对象存储在维基百科上的部分介绍</p>
<blockquote>
<h3 id="云存储-编辑"><a href="#云存储-编辑" class="headerlink" title="云存储[编辑]"></a>云存储[<a target="_blank" rel="noopener" href="https://en.wikipedia.org/w/index.php?title=Object_storage&action=edit&section=9">编辑</a>]</h3><p>主条目：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cloud_storage">云存储</a></p>
<p>市场上可用的绝大多数云存储都是对象存储架构。一些值得注意的例子是2006 年 3 月首次亮相的<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/AWS_S3">Amazon Web Services S3</a>、<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Microsoft_Azure">Microsoft Azure</a> Blob Storage、<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Rackspace">Rackspace</a> Files（其代码于 2010 年捐赠给 Openstack 项目并以<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/OpenStack#Swift">OpenStack Swift</a>的形式发布）和2010 年 5 月发布的<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Google_Cloud_Storage">Google Cloud Storage</a>。</p>
<h3 id="基于对象的文件系统-编辑"><a href="#基于对象的文件系统-编辑" class="headerlink" title="基于对象的文件系统[编辑]"></a>基于对象的文件系统[<a target="_blank" rel="noopener" href="https://en.wikipedia.org/w/index.php?title=Object_storage&action=edit&section=10">编辑</a>]</h3><p>一些分布式文件系统使用基于对象的架构，其中文件元数据存储在元数据服务器中，文件数据存储在对象存储服务器中。文件系统客户端软件与不同的服务器交互，并将它们抽象为用户和应用程序呈现完整的文件系统。</p>
<h3 id="对象存储系统-编辑"><a href="#对象存储系统-编辑" class="headerlink" title="对象存储系统[编辑]"></a>对象存储系统[<a target="_blank" rel="noopener" href="https://en.wikipedia.org/w/index.php?title=Object_storage&action=edit&section=11">编辑</a>]</h3><p>对象存储的一些早期版本被用于归档，因为实现是针对数据服务进行优化的，比如不变性，而不是性能。<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Content-addressable_storage">EMC Centera</a>和 Hitachi HCP（以前称为 HCAP）是两种常用的归档对象存储产品。另一个例子是 Quantum Lattus 对象存储平台。</p>
<p>更多通用的对象存储系统在 2008 年左右进入市场。在雅虎邮箱等 Web 应用程序中“专属”存储系统的惊人增长以及云存储的早期成功的诱惑下，对象存储系统承诺了云的规模和功能存储，能够在企业内或有抱负的云存储服务提供商处部署系统。</p>
<h3 id="混合存储-编辑"><a href="#混合存储-编辑" class="headerlink" title="混合存储[编辑]"></a>混合存储[<a target="_blank" rel="noopener" href="https://en.wikipedia.org/w/index.php?title=Object_storage&action=edit&section=12">编辑</a>]</h3><p>一些对象存储系统支持统一文件和对象 (UFO) 存储，允许一些客户端将对象存储在存储系统上，同时其他客户端将文件存储在同一存储系统上。虽然由于与混合旋转磁盘和闪存存储混淆，“混合存储”不是这个概念被广泛接受的术语，但在某些对象存储产品中可以使用 [<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Object_storage#cite_note-Crump-16">16]对同一组数据的互操作接口。</a></p>
<h3 id="“俘虏”对象存储-编辑"><a href="#“俘虏”对象存储-编辑" class="headerlink" title="“俘虏”对象存储[编辑]"></a>“俘虏”对象存储[<a target="_blank" rel="noopener" href="https://en.wikipedia.org/w/index.php?title=Object_storage&action=edit&section=13">编辑</a>]</h3><p>当对象存储产品没有商用或用例非常具体时，一些大型互联网公司开发了自己的软件。Facebook 著名地发明了他们自己的对象存储软件，代号为 Haystack，以有效地满足他们特殊的大规模照片管理需求。[<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Object_storage#cite_note-haystack-17">17]</a></p>
<h3 id="基于对象的存储设备-编辑"><a href="#基于对象的存储设备-编辑" class="headerlink" title="基于对象的存储设备[编辑]"></a>基于对象的存储设备[<a target="_blank" rel="noopener" href="https://en.wikipedia.org/w/index.php?title=Object_storage&action=edit&section=14">编辑</a>]</h3><p>协议和设备层的对象存储是 20 年前提出的[*<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Wikipedia:Please_clarify">模糊</a><em>] ，并在近 10 年前被批准用于<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/SCSI">SCSI命令集</a>[*<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Wikipedia:Please_clarify">模糊</a></em>]，称为“基于对象的存储设备命令”（OSD），[<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Object_storage#cite_note-18">18]</a>然而，它有直到希捷 Kinetic 开放式存储平台开发后才投入生产。[<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Object_storage#cite_note-19">19] </a>[<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Object_storage#cite_note-20">20]</a>对象存储设备 的<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/SCSI">SCSI</a>命令集是由 SNIA 的一个工作组为<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/International_Committee_for_Information_Technology_Standards">国际信息技术标准委员会</a>(INCITS) 的 T10 委员会开发的。[<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Object_storage#cite_note-21">21]</a> T10 负责所有 SCSI 标准。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.quobyte.com/storage-explained/what-is-kubernetes-storage">如何选择最佳 Kubernetes 存储？</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/devops-mojo/kubernetes-storage-options-overview-persistent-volumes-pv-claims-pvc-and-storageclass-sc-k8s-storage-df71ca0fccc3">Kubernetes — Storage Overview — PV, PVC and Storage Classo | Medium</a><br><a target="_blank" rel="noopener" href="https://www.modb.pro/db/15181">目前流行开源分布式存储系统的优劣对比分析 - 墨天轮</a></p>
<p>分布式服务的简单理解</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/YpRQa9YguOqJygJbdRZ-nA">数据库存储选型经验总结</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/396341725">主流分布式文件系统选型，写得太好了！ - 知乎</a></p>
<p><a target="_blank" rel="noopener" href="https://www.infoq.cn/article/Bp7uvBNb7dbGdk2gTxL9">分布式文件系统架构对比_架构_Davies_InfoQ精选文章</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.zollty.com/b/archive/relations-among-object-file-and-block-storage.html">对象存储、文件存储、块存储的区别和联系 | Zollty’s Blog</a></p>
<p>目前文件服务器分为原生云大数据之前和之后，原生云主要是应对当前大量非结构数据存储的需求，同时支持的对象存储（oss,amazon s3），文件存储实现((posix),块存储()</p>
<p>原生云之前的fastdfs,</p>
<p>目前排除hdfs原因如下</p>
<p>1 HDFS的块状存在机制，其实是不太适合小文件的，但文件服务器和网盘的场景，很大程度上会出现大量的小文件，那么HDFS在IO这块并不是优势，这样效率会很低，并且会消耗大量的主节点内存，致命伤。</p>
<p>2 HDFS并不支持随机写，这对于文件存储模型来说也是不适合的。 </p>
<p>3 HDFS的优势并不在高吞吐，所以如果是频繁读写的文件存储场景，对于他来说也是不适合的。 其实Hadoop的HDFS之所以出名，并不是单独作为文件系统而出名的，而是在于Hadoop的整套解决方案。</p>

               -->
        </div>
        
    
    <div class="article-info article-info-index">
      
      

      <!--  -->


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-minio-description" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/68368fb0.html" class="article-date">
      <time datetime="2022-03-09T06:57:24.000Z" itemprop="datePublished">2022-03-09</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/68368fb0.html">minio的入门介绍</a>
    </h1>
  

      </header>
      
    
        <div class="article-entry" itemprop="articleBody">
          
                
                            
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                            
                                
                                <p><p>minio中的概念</p>
<p>·<strong>Object</strong>：存储到Minio的基本对象，如文件、字节流，Anything…</p>
<p>·<strong>Bucket</strong>：用来存储Object的逻辑空间。每个Bucket之间的数据是相互隔离的。对于客户端而言，就相当于一个存放文件的顶层文件夹。</p>
<p>
                              
                          
                    
              <!-- 
              
              <p>minio中的概念</p>
<p>·<strong>Object</strong>：存储到Minio的基本对象，如文件、字节流，Anything…</p>
<p>·<strong>Bucket</strong>：用来存储Object的逻辑空间。每个Bucket之间的数据是相互隔离的。对于客户端而言，就相当于一个存放文件的顶层文件夹。</p>
<p>·<strong>Drive</strong>：即存储数据的磁盘，在MinlO启动时，以参数的方式传入。Minio中所有的对象数据都会存储在Drive里。</p>
<p>·<strong>Set</strong>：即一组Drive的集合，分布式部署根据集群规模自动划分一个或多个Set，每个Set中的Drive 分布在不同位置。一个对象存储在一个Set上。（For example：（1．．．64｝is divided into 4 sets each of size 1</p>
<p>​        一个对象存储在一个Set上I一个集群划分为多个Set</p>
<p>​        一个Set包含的Drive数量是固定的，默认由系统根据集群规模自动计算得出一个SET中的Drive尽可能分布在不同的节点上</p>
<h3 id="纠删码EC（Erasure-Code）"><a href="#纠删码EC（Erasure-Code）" class="headerlink" title="纠删码EC（Erasure Code）"></a>纠删码EC（Erasure Code）</h3><p>MinlO 使用纠删码机制来保证高可靠性，使用highwayhash来处理数据损坏（Bit Rot Protection）。关于纠删码，简单来说就是可以通过数学计算，把天失的数据进行还原，它可以将n份原始数据，增加m份数据，并能通过n＋m份中的任意n份数据，还原为原始数据。即如果有任意小于等于m份的数据失效，仍然能通过剩下的数据还原出来。</p>
<h4 id="分布式存储可靠性常用方法"><a href="#分布式存储可靠性常用方法" class="headerlink" title="分布式存储可靠性常用方法"></a>分布式存储可靠性常用方法</h4><p>分布式存储，很关键的点在于数据的可靠性，即保证数据的完整，不丢失，不损坏。只有在可靠性实现的前提下，才有了追求一致性、高可用、高性能的基础。而对于在存储领域，一般对于保证数据可靠性的方法主要有两类，一类是冗余法，一类是校验法。</p>
<h5 id="冗余"><a href="#冗余" class="headerlink" title="冗余"></a>冗余</h5><p>冗余法最简单直接，即对存储的数据进行副本备份，当数据出现丢失，损坏，即可使用备份内容进行恢复，而副本备份的多少，决定了数据可靠性的高低。这其中会有成本的考量，副本数据越多，数据越可靠，但需要的设备就越多，成本就越高。可靠性是允许丢失其中一份数据。当前已有很多分布式系统是采用此种方式实现，如Hadoop的文件系统（3个副本），Redis的集群，MySQL的主备模式等。</p>
<h5 id="校验"><a href="#校验" class="headerlink" title="校验"></a>校验</h5><p>校验法即通过校验码的数学计算的方式，对出现丢失、损坏的数据进行校验、还原。注意，这里有两个作用，一个校验，通过对数据进行校验和（checksum）进行计算，可以检查数据是否完整，有无损坏或更改，在数据传输和保存时经常用到，如TCP协议；二是恢复还原，通过对数据结合校验码，通过数学计算，还原丢失或损坏的数据，可以在保证数据可靠的前提下，降低冗余，如单机硬盘存储中的RAID技术，纠删码（Erasure Code）技术等。MinlO采用的就是纠删码技术。</p>
<h4 id="分布式Minio优势"><a href="#分布式Minio优势" class="headerlink" title="分布式Minio优势"></a>分布式Minio优势</h4><h5 id="数据保护"><a href="#数据保护" class="headerlink" title="数据保护"></a>数据保护</h5><p>分布式Minio采用纠删码来防范多个节点宕机和位哀减bit rot。</p>
<p>分布式Minio至少需要4个硬盘，使用分布式Minio自动引入了纠删码功能。高可用</p>
<p>单机Minio服务存在单点故障，相反，如果是一个有N块硬盘的分布式Minio，只要有N／2硬盘在线，你的数据就是安全的。不过你需要至少有N／2＋1个硬盘来创建新的对象。</p>
<p>例如，一个16节点的Minio集群，每个节点16块硬盘，就算8台服務器宕机，这个集群仍然是可读的，不过你需要9台服務器才能写数据。一致性</p>
<p>Minio在分布式和单机模式下，所有读写操作都严格遵守read—after—write一致性模型。</p>
<p><a target="_blank" rel="noopener" href="https://www.sohu.com/a/455702322_115128">漫谈 MinIO 集群扩容方法_节点</a></p>
<p>MinIO集群采用去中心化无共享架构，各节点间为对等关系，连接至任一节点均可实现对集群的访问，并通过DNS轮询等方式实现节点间的负载均衡。这种节点间保持对等关系的设计并非最常见的分布式集群架构。当前大多数的分布式存储集群，其节点往往可划分为多类角色，例如负责连接并处理外部应用请求的访问节点、负责存储元数据的管理节点、实际的数据存储节点等。MinIO则与之不同，MinIO集群中的所有节点都同时承担了多种角色，集元数据存储、数据存储、应用访问等功能于一体，真正实现了去中心化和所有节点的完全对等。其优势在于有效地减少了集群内的复杂调度过程以及因中心节点带来的故障风险和性能瓶颈。</p>
<p>这种设计拓展节点的时候容易出现问题</p>

               -->
        </div>
        
    
    <div class="article-info article-info-index">
      
      

      <!--  -->


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-aliyun-service-alarm" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/7d4de1d4.html" class="article-date">
      <time datetime="2022-03-08T02:16:22.000Z" itemprop="datePublished">2022-03-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/7d4de1d4.html">aliyun的服务警告</a>
    </h1>
  

      </header>
      
    
        <div class="article-entry" itemprop="articleBody">
          
                
                            
                                  
                                  
                                  
                                  
                                  
                                  
                            
                          
                    
              <!-- 
              
              <p><img src="../img/image-20220308101648269.png" alt="image-20220308101648269"></p>

               -->
        </div>
        
    
    <div class="article-info article-info-index">
      
      

      <!--  -->


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-curl-download-page-url-file" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/d40194d4.html" class="article-date">
      <time datetime="2022-03-07T14:07:55.000Z" itemprop="datePublished">2022-03-07</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/d40194d4.html">使用curl命令来下载页面中连接</a>
    </h1>
  

      </header>
      
    
        <div class="article-entry" itemprop="articleBody">
          
                
                            
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                            
                          
                    
              <!-- 
              
              <p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/23446635/how-to-download-http-directory-with-all-files-and-sub-directories-as-they-appear">html - How to download HTTP directory with all files and sub-directories as they appear on the online files/folders list? - Stack Overflow</a></p>
<p>wget -r -np -nH –cut-dirs=3 -R index.html <a target="_blank" rel="noopener" href="http://hostname/aaa/bbb/ccc/ddd/">http://hostname/aaa/bbb/ccc/ddd/</a></p>

               -->
        </div>
        
    
    <div class="article-info article-info-index">
      
      

      <!--  -->


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-java线程" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/8d977941.html" class="article-date">
      <time datetime="2022-03-06T11:58:16.000Z" itemprop="datePublished">2022-03-06</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/8d977941.html">java线程</a>
    </h1>
  

      </header>
      
    
        <div class="article-entry" itemprop="articleBody">
          
                
                            
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                                  
                            
                                
                                <p><p>需要先梳理java线程和系统的线程</p>
<p>通常系统是 线程 下面还有进程 thread-process</p>
<p>在java中有自己定义线程需要和系统的线程区别</p>
<p>
                              
                          
                    
              <!-- 
              
              <p>需要先梳理java线程和系统的线程</p>
<p>通常系统是 线程 下面还有进程 thread-process</p>
<p>在java中有自己定义线程需要和系统的线程区别</p>
<p>阻塞/非阻塞：是指一个业务需要a,b，c三个结果，阻塞是等待结果，非阻塞是去完成别的</p>
<p>串行/并行：这个通常是指业务逻辑的是逐个完成，还是一起完成</p>
<p>多线程：100件事的并行完成，通常还包含这线程池</p>
<p>对于多线程执行就存在资源挤占和数据处理问题通常是有两种方式</p>
<ol>
<li>锁在特定操作通常是修改数据时加锁，让其他线程逐个执行，具有排他性</li>
<li>通过刷新内存，保证多线程中某个线程修改，其他线程能拿到最新的数据</li>
</ol>
<p>要是我定义的话 线程可能会是  <strong>start  run  waiting waiting_timeout   end</strong></p>
<p>加锁的话需要参照物，java实现的就是在object 同时object对象实例有 wait 这是为啥？？</p>
<p>为什么方法和属性不放在thread类里面，后者已经有很多本地的方法，包括<br>Thread.sleep<br>Thread.yield</p>
<p>interrupt</p>
<p>join</p>
<p>sleep</p>
<hr>
<p>wait</p>
<p>notify</p>
<p>notyfyall</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>static Thread currentThread()</td>
<td>返回当前线程，即当前代码的执行线程（对象）</td>
<td>同一段代码对Thread.currentThread()的调用，其返回值可能对应着不同的线程（对象）</td>
</tr>
<tr>
<td>void run()</td>
<td>用于实现线程的任务处理逻辑</td>
<td>该方法是由Java虚拟机直接调用的，一般情况下应用程序不应该调用该方法</td>
</tr>
<tr>
<td>void start()</td>
<td>启动相应线程</td>
<td>该方法的返回并不代表相应的线程已经被启动。一个Thread实例的start方法只能够被调用一次，多次调用会导致异常的抛出</td>
</tr>
<tr>
<td>void join()</td>
<td>等待相应线程运行结束</td>
<td>若线程A调用线程B的join方法，那么线程A的运行会被暂停，直到线程B运行结束</td>
</tr>
<tr>
<td>static void yield()</td>
<td>使当前线程主动放弃其对处理器的占用，这可能导致当前线程被暂停</td>
<td>这个方法是不可靠的。该方法被调用时当前线程可能仍然继续运行（视系统当前的运行状况而定）</td>
</tr>
<tr>
<td>static void sleep(long millis)</td>
<td>使当前线程休眠（暂停运行）指定的时间</td>
<td></td>
</tr>
</tbody></table>
<p><img src="../img/937965dcce0c4a6589593d4793912fb2~tplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7071664792540282893">JAVA中的线程世界 - 掘金</a></p>

               -->
        </div>
        
    
    <div class="article-info article-info-index">
      
      

      <!-- 
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>
    </div>
 -->


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/8/"> 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/10/">下一页 </a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2024 leek
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by leek <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//lf6-cdn-tos.bytecdntp.com/cdn/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-144246563-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
             tags: ".article-tag a", 
             categories: ".article-category a, a.tag-list-link", 
            
            
            
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>